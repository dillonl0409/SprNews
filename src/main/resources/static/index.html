<!DOCTYPE html>
<html lang=zh-en>

<head>
    <meta charset=utf-8>
    <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
    <meta name=viewport content="width=device-width,initial-scale=1">
    <title>java_ssm</title>
    <link rel="stylesheet" href="./css/element-ui.css">
    <link rel="stylesheet" href="./css/global.css">
</head>

<body>
    <div id=app>
        <el-row type="flex" justify="space-between" style="margin-bottom: 10px;">
            <el-col>
                <el-button @click="openDialog" size="medium" icon="el-icon-plus" type="primary">新建</el-button>
                <el-button @click="getData()" size="medium" type="success">刷新</el-button>
            </el-col>
            <el-col :span="6">
                <el-input placeholder="请输入标题搜索" v-model="keyword" style="width: 300px;" clearable>
                </el-input>
            </el-col>
        </el-row>
        <el-table :data="data" border style="width: 100%">
            <el-table-column prop="title" label="标题" width="300">
            </el-table-column>
            <el-table-column prop="image" label="图片" width="280">
                <template slot-scope="scope">
                    <el-image style="width: 100px; height: 100px" :src="scope.row.image" :preview-src-list="scope.image">
                    </el-image>
                </template>
            </el-table-column>
            <el-table-column prop="url" label="链接" width="300">
            </el-table-column>
            <el-table-column prop="create_time" label="时间" width="300">
            </el-table-column>
            <el-table-column label="操作" width="300">
                <template slot-scope="scope">
                    <el-button @click="the(scope.row.id)" size="medium" type="primary">编辑</el-button>
                    <el-button @click="dele(scope.row.id)" size="medium" type="danger">删除</el-button>
                </template>
            </el-table-column>
        </el-table>


        <el-dialog title="表单" :visible.sync="dialogVisible" width="50%" :before-close="handleClose">
            <el-form label-width="80px" :model="form">
                <el-form-item label="新闻标题">
                    <el-input v-model="form.title" placeholder="请输入新闻标题"></el-input>
                </el-form-item>
                <el-form-item label="新闻封面">
                    <el-input v-model="form.image" placeholder="请输入新闻封面"></el-input>
                </el-form-item>
                <el-form-item label="来源链接">
                    <el-input v-model="form.url" placeholder="请输入新闻来源链接"></el-input>
                </el-form-item>
                <el-form-item label="新闻简介">
                    <el-input type="textarea" resize="none" maxlength="200" show-word-limit :autosize="{ minRows: 4, maxRows: 4}" placeholder="请输入新闻简介" v-model="form.desct">
                    </el-input>
                </el-form-item>
                <el-form-item label="新闻详情">
                    <el-input type="textarea" resize="none" :autosize="{ minRows: 20, maxRows: 50}" placeholder="请输入新闻详情" v-model="form.content">
                    </el-input>
                </el-form-item>
            </el-form>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="submit">确 定</el-button>
            </span>
        </el-dialog>
    </div>
</body>
<script src="./js/vue.min.js"></script>
<script src="./js/element-ui.index.js"></script>
<script src="./js/axios.min.js"></script>
<script>
    let el = new Vue({
        el: '#app',
        data: {
            apiurl: 'http://localhost',
            dialogVisible: false,
            keyword: '',
            form: {},
            data: [],
            isFlg:true,
        },
        mounted() {
            this.getData();
        },
        methods: {
            // 数据列表
            getData() {
                axios.get(`${this.apiurl}/news/list`).then(res => {
                    this.data = res.data
                }).catch(err => {
                    console.error(err);
                })
            },
            // 打开模态层
            openDialog() {
                this.isFlg = true
                this.form = {}
                this.dialogVisible = true
            },
            // 关闭模态层
            handleClose() {
                this.dialogVisible = false
            },
            // 提交
            submit() {
                if(this.isFlg){
                    this.add()
                }else{
                    this.edit()
                }
            },
            // 新建提交
            add(){
                axios.post(`${this.apiurl}/news/set`, this.form).then(res => {
                    this.$message({
                        message: '添加成功',
                        type: 'success'
                    });
                    this.dialogVisible = false
                    this.getData()
                }).catch(err => {
                    console.error(err);
                    this.$message({
                        message: '添加失败',
                        type: 'error'
                    });
                })
            },
            // 编辑提交
            edit(){
                axios.post(`${this.apiurl}/news/edit`, this.form).then(res => {
                    this.$message({
                        message: '编辑成功',
                        type: 'success'
                    });
                    this.dialogVisible = false
                    this.getData()
                }).catch(err => {
                    console.error(err);
                    this.$message({
                        message: '编辑失败',
                        type: 'error'
                    });
                })
            },
            // 指定
            the(id) {
                this.isFlg = false
                this.dialogVisible = true
                axios.get(`${this.apiurl}/news/the`, {
                    params: {
                        id
                    }
                }).then(res => {
                    this.form = res.data
                }).catch(err => {
                    this.$message({
                        message: '获取失败',
                        type: 'error'
                    });
                })
            },
            // 删除
            dele(id) {
                axios.get(`${this.apiurl}/news/del`, {
                    params: {
                        id
                    }
                }).then(res => {
                    this.$message({
                        message: '删除成功',
                        type: 'success'
                    });
                    this.getData()
                }).catch(err => {
                    this.$message({
                        message: '删除失败',
                        type: 'error'
                    });
                })
            }
        }
    })
</script>

</html>